<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../../bower_components/iron-form/iron-form.html">
<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-item/paper-item.html">
<link rel="import" href="../../bower_components/paper-card/paper-card.html">
<link rel="import" href="../../bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../../bower_components/paper-menu/paper-menu.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/iron-input/iron-input.html">
<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../bower_components/paper-tabs/paper-tabs.html">
<link rel="import" href="../../bower_components/paper-tab/paper-tab.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="item-card.html">
<link rel="import" href="itemlist-service.html">
<link rel="import" href="datepicker-card.html">
<link rel="import" href="item-service.html">
<meta name="viewport" content="width=device-width, initial-scale=1">
<dom-module id="item-page">
  <template>
    <style is="custom-style">
      .card{
        @apply(--layout-vertical);
        position: relative;
      //background-color: rgb(255, 255, 255);
        width: 80%;
        left: 5%;
        margin-top: 2%;
      }
      .banner1{
        @apply(--layout-horizontal);
        width: 120%;
      }
      .banner2{
        @apply(--layout-vertical);
      }
      .itemcard{
        @apply(--layout-horizontal);
        width: 120%;
      }
      paper-tabs{
        background-color: #e5efe2;
        width: 112%;
        margin-top: 5%;
        height: 4%;
      }
      paper-button{
        font-size: 15px;
        text-transform: none;

      }
      paper-input{
        text-align: left;
        width: 30%;
        margin-left: 10%;
      }
      hr{
        width: 111.5%;
      }
      .additem,.save{
        text-align: left;
      }
      .hr1{
        margin-top: 5%;
        width: 111.5%;
      }
      paper-icon-button{
        margin-left: 10%;
      }
      .buttons{
        margin-left:-75%;
      }
      .datetitle{
        margin-left: 48%;
      }
      #datetitle{
        font-size: 13px;
        color: blue;
      }
      .supname{
        margin-left: 500px;
        width: 26%;
      }
      .delete{
        margin-top:2%;
      }
      .additem,.save{
        text-align: center;
      //width: 35%;
        border-radius: 2px;
        box-shadow: rgba(0, 0, 0, 0.0980392) 5px 5px 4px, rgba(0, 0, 0, 0.0980392) 0px 0px 10px;
        background-color: #3d6868;
        color: white;
        height: 30px;
      //margin-top: 4%;
      }
    </style>

    <div class="card">
      <div class="banner1">
        <paper-input class="supname" name="supname" label="Supplier Name" value="{{supname}}" required id="supname" error-message="Enter supplier name" on-keydown="changed" ></paper-input>
      </div>
      <div class="banner2">
        <paper-tabs selected="0" noink id="ptab">
          <paper-tab><paper-button on-tap="description">Item Description</paper-button></paper-tab>
          <paper-tab><paper-button on-tap="received">Quantity Received</paper-button></paper-tab>
          <paper-tab><paper-button on-tap="remarks">Remarks</paper-button></paper-tab>
        </paper-tabs>
        <template is="dom-repeat" items="{{itemArray}}" as="item">
          <div class="itemcard">
            <div><item-card id="{{item.id}}" description="{{item.description}}" ordered="{{item.ordered}}" received="{{item.received}}" qc="{{item.qc}}" remark="{{item.remark}}"></item-card>
            </div>
            <div class="delete"><paper-icon-button icon="icons:delete" on-click="delete" style="right:10px;height:40px;"></paper-icon-button></div>
          </div>
        </template>
        <div layout horizontal class="buttons">
          <paper-button on-click="additem" class="additem" id="additem" >Add Item</paper-button>
          <paper-button on-click="save" class="save" id="save" >Save</paper-button>
        </div>
      </div>
    </div>

    <item-service id="itemservice"></item-service>
  </template>
  <script>
    (function(){
      var itemarr=[];

      Polymer({
        is: "item-page",
        ready:function()
        {
          this.nullflag=0;
          this.flag=0;
          this.itemflag=0;
          this.idd=0;
          localStorage.setItem("curr_sess_unitset",this.idd);
          this.itemArray=[{id:this.idd,description:'',received:'',unit:'',remark:''}];
          this.splice('itemArray',1,1);
        },
        changed:function(){
          //alert('yes');
          this.nullflag=1;
        },
        setVehicleinfo:function(invoiceno,vno,vname,dname,dno)
        {
          this.invoiceno=invoiceno;
          this.invoicedate=localStorage.getItem("localsess_curr_inwarddate");
          this.vno=vno;
          this.vname=vname;
          this.dname=dname;
          this.dno=dno
          //alert(this.vno+"  "+this.vname+"  "+this.dname+"  "+this.dno);
        },
        setIteminfo:function(qtyreceived,remark){
          this.flag=1;
          this.qtyreceived=qtyreceived;
          this.remark=remark;
        },
        setMenuinfo:function(itemdes,unit){
          //alert(itemdes+"  "+unit);
          this.unit=unit;
          localStorage.setItem("curr_sess_showunitvalue",unit);
          this.itemflag=1;
          this.itemdes=itemdes;
        },
        additem:function(e)
        {
          //alert(e.model.index);
          this.$.supname.validate();
          if(this.flag!=1)
          {
            this.qtyreceived=null;
            this.remark=null;
          }
          if(this.itemflag!=1)
            this.itemdes=null;
          //this.itemdes=localStorage.getItem("localsess_curr_itemdes");
          //this.qtyreceived=localStorage.getItem("localsess_curr_qtyreceived");
          //this.remark=localStorage.getItem("localsess_curr_remark");
          var existflag=0;
          var deleteflag=0;
          //alert(this.invoiceno+"  "+this.invoicedate+"  "+this.vno+"  "+this.vname+"  "+this.dname+"  "+this.dno+" "+this.itemdes+" "+this.qtyreceived+" "+this.remark);
          if(this.itemdes=='deleted'||this.qtyreceived=='deleted'){
            deleteflag=1;
          }
          if(this.itemdes==null||this.qtyreceived==null||this.nullflag==0)
          {
            alert("All fields must want to be filled");
          }
          else
          {
            for(var i=0;i<itemarr.length;i++)
            {
              if(itemarr[i].itemdes==this.itemdes){
                existflag=1;
                alert("Item already exist!");
              }
              if(existflag==1){
              }
            }
            if(existflag==0){
              var obj={"invoiceno":"","invoicedate":"","supplier":"","itemdes":"","qtyreceive":"","remark":"","unit":""};
              obj.invoiceno=this.invoiceno;
              obj.invoicedate=this.invoicedate;
              obj.supplier=this.supname;
              obj.itemdes=this.itemdes;
              obj.qtyreceive=this.qtyreceived;
              obj.remark=this.remark;
              obj.unit=this.unit;
              if(deleteflag!=1)
                itemarr.push(obj);
              this.idd=this.itemArray.length;
              localStorage.setItem("curr_sess_unitset",this.idd);
              //alert(JSON.stringify(itemarr));
              this.push('itemArray',{id:this.idd,description:'',received:'',unit:'',remark:''});
              //alert(JSON.stringify(this.itemArray.length));
              this.flag=0;
              this.itemflag=0;
            }
          }
        },
        save:function(){
          if(localStorage.getItem("curr_sess_saveflag")=="false"){
            if(this.flag!=1)
            {
              this.qtyreceived=null;
              this.remark=null;
            }
            if(this.itemflag!=1)
              this.itemdes=null;
            //this.itemdes=localStorage.getItem("localsess_curr_itemdes");
            //this.qtyreceived=localStorage.getItem("localsess_curr_qtyreceived");
            //this.remark=localStorage.getItem("localsess_curr_remark");
            var existflag=0;
            var deleteflag=0;
            //alert(this.invoiceno+"  "+this.invoicedate+"  "+this.vno+"  "+this.vname+"  "+this.dname+"  "+this.dno+" "+this.itemdes+" "+this.qtyreceived+" "+this.remark);
            if(this.itemdes=='deleted'||this.qtyreceived=='deleted'){
              deleteflag=1;
            }
            if(this.itemdes==null||this.qtyreceived==null||this.supname==null)
            {
              alert("All fields must want to be filled");
            }
            else
            {
              for(var i=0;i<itemarr.length;i++)
              {
                if(itemarr[i].itemdes==this.itemdes){
                  existflag=1;
                  alert("Item already exist!");
                }
                if(existflag==1){
                }
              }
              if(existflag==0){
                var obj={"invoiceno":"","invoicedate":"","supplier":"","itemdes":"","qtyreceive":"","remark":"","unit":""};
                obj.invoiceno=this.invoiceno;
                obj.invoicedate=this.invoicedate;
                obj.supplier=this.supname;
                obj.itemdes=this.itemdes;
                obj.qtyreceive=this.qtyreceived;
                obj.unit=this.unit;
                obj.remark=this.remark;
                if(deleteflag!=1)
                  itemarr.push(obj);
                //alert(JSON.stringify(itemarr));
                this.flag=0;
                this.itemflag=0;
                this.$.itemservice.itemwriteService(this.invoiceno,this.invoicedate,this.vno,this.vname,this.dname,this.dno,itemarr)
              }

            }
            //document.querySelectorAll("paper-input").readonly=true;
            //alert(this.querySelector("item-card"));
          }
          else{
            alert("Item already saved..!Click create to enter another invoice!");
          }

        },
        delete:function(e)
        {
          itemarr.splice(e.model.index,1);
          this.splice('itemArray',e.model.index,1);
          this.itemdes='deleted';
          this.qtyreceived='deleted';
          this.remark='deleted';
          this.flag=1;
          this.itemflag=1;
          //alert(JSON.stringify(itemarr));
        }
      });
    })();
  </script>

</dom-module>
